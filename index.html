<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AI & Международные отношения - Расширенная карта</title>
<style>
html, body { height: 100%; }
:root { --app-scale: 0.92; --hh: 0px; }

body {
  font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
  background: linear-gradient(135deg,#0f172a 0%,#1e293b 100%);
  color: #e2e8f0;
  margin: 0;
}

/* Глобальный зум-аўт всей страницы */
#app{
  transform: scale(var(--app-scale));
  transform-origin: top left;
  width: calc(100% / var(--app-scale));
  height: calc(100dvh / var(--app-scale));
  overflow: hidden;
}

header {
  background: rgba(30,41,59,0.95);
  border-bottom: 2px solid #334155;
  padding: 14px 18px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.3);
}
h1 { font-size: 22px; font-weight: 700; color: #f1f5f9; margin-bottom: 7px; }
.subtitle { font-size: 13px; color: #94a3b8; }
.legend {
  padding: 7px 14px;
  font-size: 12px;
  background: rgba(30,41,59,0.84);
  border: 1.5px solid #334155;
  border-radius: 8px;
  margin: 8px 0 0 7px;
  display: flex;
  gap: 16px;
  align-items: center;
}
.legend-item { display: flex; align-items: center; gap: 5px; font-size: 12px; }
.legend-star { color: #c026d3; font-weight: bold; margin-right: 3px; font-size: 15px; }
.legend-circle { width: 13px; height: 13px; border-radius: 50%; display: inline-block; margin-right: 3px; }

/* Рабочая область учитывает реальную высоту шапки */
#main-container {
  display: flex;
  height: calc(100dvh - var(--hh));
  overflow: hidden;
}
#canvas-container { flex: 1; position: relative; min-width: 240px; }

/* Sidebar подчиняется высоте родителя */
#sidebar {
  display: grid;
  grid-template-rows: min-content min-content 1fr min-content;
  height: 100%;
  font-size: 13px;
  padding: 12px;
  width: 340px;
  min-width: 200px;
  background: rgba(30,41,59,0.95);
  box-sizing: border-box;
  color: #e2e8f0;
  overflow: hidden;
}

/* Внутренние прокручиваемые области в grid: важно min-height:0 */
#cluster-list {
  min-height: 0;
  overflow-y: auto;
  padding-bottom: 16px;
}
.publications-section {
  max-height: 220px;
  overflow-y: auto;
  padding-bottom: 16px;
}

/* Контент */
.sidebar-title { font-size: 15px; font-weight: 700; color: #f1f5f9; margin-bottom: 8px; }
.cluster-list-title { font-size: 12px; margin-bottom: 5px; color: #94a3b8; }
.back-btn {
  background: rgba(59,130,246,0.17)!important;
  border: 1px solid #3b82f6;
  color: #60a5fa;
  padding: 7px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 13px;
  margin-bottom: 8px;
  margin-top: 3px;
  transition: all 0.18s;
  display: none;
  font-weight: 500;
  outline: none;
}
.back-btn.visible { display: block; }
.back-btn:hover { background: rgba(59,130,246,0.25); border-color: #60a5fa; }

.cluster-item {
  background: rgba(15,23,42,0.62);
  border-radius: 7px;
  padding: 7px 9px;
  margin-bottom: 3px;
  cursor: pointer;
  transition: all 0.17s;
  border: 1px solid transparent;
  font-size: 12px;
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.cluster-item:hover { background: rgba(51,65,85,0.8); border-color: #475569; transform: translateX(2px); }
.cluster-item.selected { background: rgba(59,130,246,0.21); border: 2px solid #fff!important; box-shadow: 0 0 0 2px #3b82f6,0 2px 8px rgba(59,130,246,0.07); }
.cluster-item.russia-related { border-left: 2px solid #c026d3; }
.cluster-icon { display: inline-block; width: 14px; height: 14px; border-radius: 50%; margin-right: 3px; vertical-align: middle; border: 1px solid #222831; }
.cluster-star { color: #c026d3; font-size: 13px; font-weight: bold; margin-right: 2px; vertical-align: middle; }
.cluster-pubcount { font-size: 12px; font-weight: bold; border-radius: 7px; min-width: 28px; padding: 0 4px; margin-left: 6px; text-align: center; display: inline-block; }

.connection-item { background: rgba(15,23,42,0.6); border-radius: 5px; padding: 7px 7px; margin-bottom: 5px; cursor: pointer; transition: all 0.14s; display: flex; align-items: center; font-size: 12px;}
.connection-item .conn-info { display: flex; align-items: center; gap: 6px; flex-grow: 1; }
.connection-strength { display: flex; gap: 3px; }
.strength-dot { width: 5px; height: 5px; border-radius: 50%; background: #60a5fa; }
.conn-icon { display: inline-block; width: 12px; height: 12px; border-radius: 50%; border: 1px solid #222831; }
.conn-pubcount { font-size: 11px; font-weight: bold; border-radius: 7px; min-width: 23px; padding: 0 4px; margin-left: 4px; text-align: center; display: inline-block; }

.publication-item { background: rgba(30,41,59,0.6); border-radius: 5px; padding: 8px; margin-bottom: 6px; border-left: 2px solid #3b82f6; transition: all 0.14s; font-size: 11px;}
.publication-item:hover { background: rgba(51,65,85,0.8); transform: translateX(1px); }
.publication-link { color: #60a5fa; text-decoration: none; font-size: 11px;}

::-webkit-scrollbar { width: 7px; }
::-webkit-scrollbar-track { background: rgba(15,23,42,0.35); }
::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: #64748b; }

canvas { cursor: grab; display: block; width: 100%; height: 100%; }
canvas:active { cursor: grabbing; }

#controls { position: absolute; top: 16px; right: 16px; display: flex; flex-direction: column; gap: 7px; z-index: 10; }
.control-btn { background: rgba(30,41,59,0.94); border: 1px solid #475569; color: #f1f5f9; width: 33px; height: 33px; border-radius: 8px; cursor: pointer; font-size: 16px; transition: all 0.18s; box-shadow: 0 3px 5px rgba(0,0,0,0.25); }
.control-btn:hover { background: rgba(51,65,85,0.93); border-color: #64748b; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.32); }

#tooltip { position: absolute; bottom: 16px; left: 16px; background: rgba(30,41,59,0.97); border: 1px solid #475569; border-radius: 12px; padding: 12px 16px; max-width: 260px; box-shadow: 0 7px 10px rgba(0,0,0,0.33); display: none; z-index: 11; font-size: 12px;}
#tooltip.visible { display: block; }

/* Адаптивные стили */
@media (max-width: 900px) {
  #sidebar { width: 220px; padding:8px; font-size: 12px;}
  header { padding: 12px 6px; }
  .legend { gap: 7px; }
}
@media (max-width: 700px) {
  #sidebar { width: 100% !important; max-width:100vw; height: auto; min-height: 80px; max-height: 56vh; padding: 8px; }
  #cluster-list { max-height:29vh; min-height:24px; overflow-y: auto; padding-bottom: 12px; }
  .publications-section { max-height:70px; overflow-y:auto; padding-bottom: 12px; }
}
@media (max-width: 430px) {
  h1 { font-size: 13px; }
  .subtitle { font-size: 9px;}
  .sidebar-title, .cluster-list-title { font-size: 10px; }
  .cluster-item, .connection-item { font-size:10px; padding:5px 4px;}
  .publications-section { max-height:50px; overflow-y:auto;}
}
</style>
</head>

<body>
<div id="app">
<header>
  <h1>Интерактивная карта: ИИ и международные отношения (с российским контекстом)</h1>
  <div class="subtitle">Визуализация научных кластеров • Размер узла = объем публикаций • Толщина линии = сила связи • <span class="legend-star">*</span> Российские темы</div>
  <div class="legend">
    <span class="legend-item"><span class="legend-circle" style="background:#3b82f6"></span>Научный кластер</span>
    <span class="legend-item"><span class="legend-star">*</span>Российские темы</span>
    <span class="legend-item">Толщина линии = сила связи</span>
    <span class="legend-item">Размер кружка = публикаций</span>
  </div>
</header>

<div id="main-container">
  <div id="canvas-container">
    <canvas id="network-canvas"></canvas>
    <div id="controls">
      <button class="control-btn" id="zoom-in" title="Увеличить">+</button>
      <button class="control-btn" id="zoom-out" title="Уменьшить">−</button>
      <button class="control-btn" id="reset" title="Сбросить">⟲</button>
    </div>
    <div id="tooltip">
      <div class="tooltip-title"></div>
      <div class="tooltip-papers"></div>
      <div class="tooltip-hint">Нажмите для подробностей</div>
    </div>
    <div id="desc-popup" style="display:none;position:absolute;right:20px;bottom:20px;z-index:20;max-width:350px;min-width:210px;background:rgba(30,41,59,.98);color:#fff;border-radius:18px;border:1.5px solid #3b82f6;box-shadow:0 8px 22px rgba(59,130,246,0.14);padding:18px 22px 12px 22px;"></div>
  </div>

  <div id="sidebar">
    <button id="back-btn" class="back-btn">← Назад к обзору</button>
    <div class="sidebar-title">Исследовательские кластеры</div>
    <div class="cluster-list-title"></div>
    <div id="cluster-list"></div>
    <div class="publications-section"></div>
  </div>
</div>
</div>

<script>
/* Учет фактической высоты header для calc(100dvh - var(--hh)) */
function setHeaderH(){
  const hh = document.querySelector('header')?.offsetHeight || 0;
  document.documentElement.style.setProperty('--hh', hh + 'px');
}
window.addEventListener('resize', setHeaderH);
setHeaderH();

/* Ваши данные и логика рисования */
const clusters = [
  { id: 1, label: "AI Governance", x: 400, y: 300, size: 45, color: "#3b82f6", papers: 1250,
  ru: "Управление ИИ", desc: "Вопросы регулирования, стандартов и глобальной ответственности в области искусственного интеллекта." }
, 
{"id": 2, "label": "AI & Military Strategy", "x": 250, "y": 200, "size": 38, "color": "#ef4444", "papers": 890}, 
{"id": 3, "label": "Cyber Security", "x": 200, "y": 320, "size": 35, "color": "#dc2626", "papers": 780}, 
{"id": 4, "label": "Autonomous Weapons", "x": 150, "y": 180, "size": 32, "color": "#991b1b", "papers": 650}, {"id": 5, "label": "Tech Sovereignty", "x": 550, "y": 180, "size": 36, "color": "#8b5cf6", "papers": 820}, {"id": 6, "label": "US-China AI Competition", "x": 650, "y": 250, "size": 40, "color": "#7c3aed", "papers": 950}, {"id": 7, "label": "Digital Authoritarianism", "x": 600, "y": 350, "size": 33, "color": "#6d28d9", "papers": 720}, {"id": 8, "label": "AI & Global Economy", "x": 450, "y": 480, "size": 37, "color": "#10b981", "papers": 840}, {"id": 9, "label": "Trade Policy & Tech", "x": 320, "y": 520, "size": 30, "color": "#059669", "papers": 620}, {"id": 10, "label": "Labor Markets", "x": 550, "y": 550, "size": 28, "color": "#047857", "papers": 580}, {"id": 11, "label": "Multilateral AI Policy", "x": 280, "y": 400, "size": 34, "color": "#f59e0b", "papers": 750}, {"id": 12, "label": "International Standards", "x": 380, "y": 150, "size": 31, "color": "#d97706", "papers": 680}, {"id": 13, "label": "EU AI Regulation", "x": 480, "y": 120, "size": 33, "color": "#b45309", "papers": 710}, {"id": 14, "label": "AI Ethics in IR", "x": 150, "y": 450, "size": 32, "color": "#ec4899", "papers": 690}, {"id": 15, "label": "Surveillance & Privacy", "x": 100, "y": 350, "size": 29, "color": "#db2777", "papers": 610}, {"id": 16, "label": "Digital Rights", "x": 200, "y": 520, "size": 27, "color": "#be185d", "papers": 560}, {"id": 17, "label": "AI & Climate Diplomacy", "x": 650, "y": 450, "size": 26, "color": "#14b8a6", "papers": 540}, {"id": 18, "label": "Disinformation & Propaganda", "x": 700, "y": 350, "size": 30, "color": "#f97316", "papers": 640}, {"id": 19, "label": "AI in Intelligence", "x": 300, "y": 250, "size": 28, "color": "#7f1d1d", "papers": 590}, {"id": 20, "label": "Emerging Tech Alliances", "x": 550, "y": 280, "size": 29, "color": "#5b21b6", "papers": 605}, {"id": 21, "label": "Global South & AI", "x": 400, "y": 580, "size": 27, "color": "#0891b2", "papers": 570}, {"id": 22, "label": "Indo-Pacific Strategy", "x": 680, "y": 180, "size": 28, "color": "#4338ca", "papers": 585}, {"id": 23, "label": "Russia AI Strategy & Sovereignty", "x": 500, "y": 400, "size": 32, "color": "#c026d3", "papers": 680, "isRussia": true}, {"id": 24, "label": "Russia-China AI Cooperation", "x": 620, "y": 420, "size": 30, "color": "#a21caf", "papers": 620, "isRussia": true}, {"id": 25, "label": "BRICS AI Governance", "x": 380, "y": 430, "size": 31, "color": "#f97316", "papers": 650, "isRussia": true}];
const initialPositions = clusters.map(n => ({ id: n.id, x: n.x, y: n.y }));
const connections = [{"from": 1, "to": 2, "weight": 3}, {"from": 1, "to": 5, "weight": 4}, {"from": 1, "to": 6, "weight": 3}, {"from": 1, "to": 8, "weight": 3}, {"from": 1, "to": 11, "weight": 4}, {"from": 1, "to": 12, "weight": 3}, {"from": 1, "to": 13, "weight": 4}, {"from": 1, "to": 14, "weight": 3}, {"from": 2, "to": 3, "weight": 3}, {"from": 2, "to": 4, "weight": 4}, {"from": 2, "to": 6, "weight": 3}, {"from": 2, "to": 19, "weight": 2}, {"from": 3, "to": 15, "weight": 3}, {"from": 3, "to": 18, "weight": 2}, {"from": 4, "to": 12, "weight": 2}, {"from": 5, "to": 6, "weight": 4}, {"from": 5, "to": 7, "weight": 3}, {"from": 5, "to": 13, "weight": 2}, {"from": 5, "to": 20, "weight": 3}, {"from": 6, "to": 7, "weight": 3}, {"from": 6, "to": 8, "weight": 2}, {"from": 6, "to": 18, "weight": 2}, {"from": 6, "to": 22, "weight": 3}, {"from": 7, "to": 15, "weight": 4}, {"from": 7, "to": 18, "weight": 4}, {"from": 8, "to": 9, "weight": 3}, {"from": 8, "to": 10, "weight": 3}, {"from": 8, "to": 21, "weight": 2}, {"from": 9, "to": 10, "weight": 2}, {"from": 9, "to": 12, "weight": 2}, {"from": 11, "to": 12, "weight": 3}, {"from": 11, "to": 13, "weight": 3}, {"from": 11, "to": 14, "weight": 2}, {"from": 12, "to": 13, "weight": 4}, {"from": 13, "to": 14, "weight": 2}, {"from": 14, "to": 15, "weight": 3}, {"from": 14, "to": 16, "weight": 3}, {"from": 15, "to": 16, "weight": 3}, {"from": 17, "to": 8, "weight": 2}, {"from": 17, "to": 11, "weight": 2}, {"from": 18, "to": 19, "weight": 2}, {"from": 19, "to": 2, "weight": 3}, {"from": 20, "to": 22, "weight": 2}, {"from": 21, "to": 14, "weight": 2}, {"from": 3, "to": 19, "weight": 3}, {"from": 21, "to": 8, "weight": 3}, {"from": 23, "to": 1, "weight": 3}, {"from": 23, "to": 5, "weight": 4}, {"from": 23, "to": 7, "weight": 3}, {"from": 23, "to": 11, "weight": 3}, {"from": 24, "to": 6, "weight": 4}, {"from": 24, "to": 23, "weight": 4}, {"from": 24, "to": 20, "weight": 3}, {"from": 25, "to": 11, "weight": 4}, {"from": 25, "to": 23, "weight": 4}, {"from": 25, "to": 1, "weight": 3}, {"from": 25, "to": 21, "weight": 3}];
const canvas = document.getElementById('network-canvas');
const ctx = canvas.getContext('2d');
const tooltip = document.getElementById('tooltip');
let W,H,zoom=1,panX=0,panY=0,isDrag=false,sx=0,sy=0,selected=null, hoveredNode = null;
let draggingNode = null;
let dragOffsetX = 0, dragOffsetY = 0;

function resize(){
  W = canvas.width = canvas.parentElement.clientWidth;
  H = canvas.height = canvas.parentElement.clientHeight;
  if(panX===0&&panY===0){ panX=W/2-400; panY=H/2-300; }
  draw();
}
window.addEventListener('resize',resize);
resize();

canvas.addEventListener('mousedown', e => {
  const r = canvas.getBoundingClientRect();
  const x = (e.clientX - r.left - panX) / zoom;
  const y = (e.clientY - r.top - panY) / zoom;
  const hit = clusters.find(n => Math.hypot(x - n.x, y - n.y) < n.size);
  if (hit) {
    draggingNode = hit;
    dragOffsetX = x - hit.x;
    dragOffsetY = y - hit.y;
    isDrag = false;
  } else {
    isDrag = true;
    sx = e.clientX - panX;
    sy = e.clientY - panY;
  }
});

canvas.addEventListener('mousemove', e => {
  const r = canvas.getBoundingClientRect();
  const x = (e.clientX - r.left - panX) / zoom;
  const y = (e.clientY - r.top - panY) / zoom;
  if (draggingNode) {
    draggingNode.x = x - dragOffsetX;
    draggingNode.y = y - dragOffsetY;
    draw();
  } else if (isDrag) {
    panX = e.clientX - sx;
    panY = e.clientY - sy;
    draw();
  } else {
    hoveredNode = clusters.find(n => Math.hypot(x - n.x, y - n.y) < n.size);
    updateTooltip(hoveredNode);
    draw();
  }
});

canvas.addEventListener('mouseup', () => { draggingNode = null; isDrag = false; });
canvas.addEventListener('mouseleave', () => { draggingNode = null; isDrag = false; hoveredNode = null; updateTooltip(null); draw(); });

function updateTooltip(node){
  if(!node){ tooltip.classList.remove('visible'); return; }
  tooltip.querySelector('.tooltip-title').textContent = node.label;
  tooltip.querySelector('.tooltip-papers').textContent = `Публикаций: ${node.papers||'-'}`;
  tooltip.classList.add('visible');
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(panX, panY);
  ctx.scale(zoom, zoom);
  clusters.forEach(n => {
    ctx.beginPath();
    ctx.fillStyle = n.color;
    ctx.arc(n.x, n.y, n.size, 0, Math.PI*2);
    ctx.fill();
  });
  ctx.restore();
}
</script>
</body>
</html>
